---
layout: default
title: "Monster!! (WIP)"
category: 
tags: []
---
{% include JB/setup %}
This time, is the time for monsterwm. Lately I use this minimalist wm, yes it's a tiling wm, and figure something out. Monsterwm is awesome. It comes with pre-config. Much like dwm, you must config the wm before compile it so you can use it. I don't really like the concept of pre-config wm at first. I think, such a pain in the ass. We must make, make install, then log out from X and relogin. But after using it for a while, I found this wm is pretty customizable.

<br>
What I want, is to make this clone of xmonad desktop using some other wm. For that, I will use monsterwm with some of its pre-configuration and make another desktop that resembles it.

![xmonad with the song of bump of chicken - knife](/img/dsktp-bocknife.png)

<br>
Okay, let's move to the documentation
<br>

First, you clone it using git. In this case, I'm using its branch 'uselessgap' so I can add a Gap between each window that stacked. 

credit to c00kiemon5ter for making this awesome wm.

{% highlight bash %}
$ git clone https://github.com/c00kiemon5ter/monsterwm.git
$ cd monsterwm
$ git checkout uselessgap
$ cd monsterwm
{% endhighlight %}

If you `ls` inside its directory, you can see there is `config.def.h`. Or usually just `config.h`. It's okay. We will just proceed to the next step. Configuring monsterwm's pre-config.

{% highlight bash %}
(~/g/monsterwm) (master) ls
config.def.h  config.h  LICENSE  Makefile  monsterwm.1  monsterwm.c  README.md
{% endhighlight %}

<br>
Edit `config.h` or `config.def.h` using your favorite editor. I'm using vim, just so you know. Inside, we will stumble upon many line of code, so I will skip some code, and just edit the ones that i need.

{% highlight c linenos %}
/** modifiers **/
#define MOD1            Mod1Mask
#define MOD4            Mod4Mask
#define MOD5            Mod5Mask
#define CONTROL         ControlMask
#define SHIFT           ShiftMask

/** generic settings **/
#define MASTER_SIZE     0.76
#define SHOW_PANEL      True
#define TOP_PANEL       True
#define PANEL_HEIGHT    16
#define DEFAULT_MODE    TILE
#define ATTACH_ASIDE    True
#define FOLLOW_WINDOW   False
#define FOLLOW_MOUSE    False
#define CLICK_TO_FOCUS  True
#define FOCUS_BUTTON    Button3
#define BORDER_WIDTH    3
#define FOCUS           "#181818"
#define UNFOCUS         "#141414"
#define MINWSZ          50
#define DEFAULT_DESKTOP 0
#define DESKTOPS        3
{% endhighlight %} 

I define `MOD1`, `MOD4`, and `MOD5` for `altkey`, `superkey`, and I already forgot what `MOD5` means respectively. As you can see we can define anything in that header file. Underneath that code, we can find many `keybindings` configuration. So, I will leave that area in your preferences. I only change small parts for `keybindings`.

{% highlight c linenos %}
static const char *menucmd[]	   = { "dmenu_run", "-fn", "terminus 9", NULL};
static const char *filecmd[]	   = { "pcmanfm", NULL };
static const char *termcmd[]	   = { "termite", NULL };
static const char *webcmd[]	   = { "dwb", NULL };

--- and so on

/**
 * keyboard shortcuts
 */
static Key keys[] = {
    /* modifier		key            function           argument */
    {  MOD1,            XK_p,          spawn,             {.com = menucmd}},
    {  MOD1,            XK_w,          spawn,             {.com = webcmd}},
    {  MOD1,            XK_t,          spawn,             {.com = filecmd}},
    {  MOD1|SHIFT,      XK_Return,     spawn,             {.com = termcmd}},

--- and so on
{% endhighlight %}

<br>
Aaaaand, we're done. Just type `make` and then `sudo make install` in your terminal to make our 'configed' monsterwm on the run.

What now? If we try our monsterwm, it's just a blank screen with some control of window. There will be no bar, no wallpaper, and no, I don't like emptiness. So, the next step is to costumize the bar, the wallpaper, and the other complimentaries to make this wm okay to use.

For the top panel, I will use LemonBoy's `bar`. It's like dzen2, but with its own plus minus. You can use whatever panel you want. The configuration is pretty easy I think. There is no xft support on the LemonBoy's `bar`, so if you want something that has xft support, you can use dzen2 or raedwulf's version of `bar` with full xft support. Your choice. 

<br>
Okay, we will begin. 

First, monsterwm is not xmonad. So we must config it before start it. Means, we have to parse some of its output and change it. Confusing? I can't tell you what actually I mean, so let's just make some code. May the Code bless us with its understanding. I will make `startup` file to launch monsterwm and it's complimentaries.

{% highlight bash linenos %}
ff="/tmp/monsterwm.fifo"             # this part is to parse the output of monsterwm
[[ -p $ff ]] || mkfifo -m 600 "$ff"  # running on the wild

xset +fp ~/.fonts/custom/ &          
xset fp rehash &
~/.fehbg &
compton -f -D8 -I0.05 -O0.05 &
xsetroot -cursor_name left_ptr &
sh ~/.wm/monsterwm/status.sh &
devmon &
wmname LG3D &

# and above is just what i usually run side to side with most of my wm
{% endhighlight %} 

<br>
And the rest is to put the output of our parsing into `bar`. For now, I'm too lazy to explaining what in the name of hell is the meaning of this code. Maybe later when I'm not busy.

{% highlight bash linenos%}
while read -r; do
    # filter output to only what we want to match and parse
    [[ $REPLY =~ ^(([[:digit:]]+:)+[[:digit:]]+ ?)+$ ]] && read -ra desktops <<< "$REPLY" || continue
    
    for desktop in "${desktops[@]}"; do
        # set values for
        # d - the desktop id
        # w - number of windows in that desktop
        # m - tiling layout/mode for that desktop
        # c - whether that desktop is the current (1) or not (0)
        # u - whether a window in that desktop has an urgent hint set (1) or not (0)
        IFS=':' read -r d w m c u <<< "$desktop"
 
        # name each desktop 
        case $d in
            0) d=" term" s=" "   ;;
            1) d=" web" s=" " ;;
            2) d=" fun" s=" " ;;
	    3) d=" work" s=" " ;;
        esac
 
       # name each layout/mode with a symbol underline=FF364069
	((c)) && b="#FF272727" u="#FFA93432" && case $m in
            0) i="  %{B#FF333333}  %{B}" ;;
            1) i="   ⮘ " ;;
            2) i="  [B]" ;;
            3) i="  [G]" ;;
        esac  || b="#FF161616" u="#FF161616"
 
        # if the desktop has an urgent hint its color should be #ff0000
        ((u)) && b="#FFFF7871"
 
        # if the desktop has windows print that number next to the desktop name
        # else just print the desktop name
        ((w)) && r+="%{B$b}%{U$u}%{+u} $d %{F#FF3E3E3E}[$w]%{F} %{-u}%{B}" || r+="%{B$b}%{U$u}%{+u} $d %{F#FF3E3E3E}[-]%{F} %{-u}%{B}"
    done
    # read from fifo and output to dzen2
    printf "%s%s\n" "$r" "$i" && unset r
done < "$ff" | bar -p -d -g 300x17+0+0 -f '-*-stlarch-*-*-*-*-10-*-*-*-*-*-*-*,-*-lemon-*-*-*-*-10-*-*-*-*-*-*-*' -u 3 -B '#FF161616' -F "FF9A9A9A"&
 
# pass output to fifo
monsterwm > "$ff"
{% endhighlight %}

<br>

The code above will make the bar look like this.

![monsterbar](/img/monster-bar.png)

Next, we will try to make statusbar beside the main bar. My purpose is to make something like the following screenshot. Including the wallpaper, terminal (which is `rxvt-unicode`), and the other complimentaries that running in the terminal. Here is the screenshot what it has to be if we continue tweaking.

![monsterwm](/img/monster.png)

-----

<div class="note">
You can get code above here <a href="https://github.com/gegenokitaro/dot/tree/master/config_desktop/Monster">Monster!!</a>
</div>
